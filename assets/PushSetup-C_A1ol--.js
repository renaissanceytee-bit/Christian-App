import{r as o,j as s}from"./index-C_nPgQsY.js";const f={},c=(f==null?void 0:f.VITE_PUSH_SERVER_URL)||"http://localhost:4000";function v(l){const d="=".repeat((4-l.length%4)%4),u=(l+d).replace(/-/g,"+").replace(/_/g,"/"),n=atob(u),a=new Uint8Array(n.length);for(let t=0;t<n.length;++t)a[t]=n.charCodeAt(t);return a}function N(){const[l,d]=o.useState(!1),[u,n]=o.useState(Notification.permission),[a,t]=o.useState(!1),[p,r]=o.useState(!1);o.useEffect(()=>{d("serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(async e=>{const i=await e.pushManager.getSubscription();t(!!i)}).catch(()=>{})},[]);async function h(){r(!0);try{const e=await Notification.requestPermission();if(n(e),e!=="granted")return r(!1),alert("Permission denied for notifications.");const i=await fetch(`${c}/vapidPublicKey`);if(!i.ok)throw new Error("Failed to fetch VAPID key");const{publicKey:y}=await i.json(),m=v(y),S=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:m});await fetch(`${c}/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}),t(!0),alert("Subscribed to background notifications. Use the server to send test pushes.")}catch(e){console.error(e),alert("Subscription failed — check console for details.")}r(!1)}async function b(){r(!0);try{const i=await(await navigator.serviceWorker.ready).pushManager.getSubscription();i&&(await fetch(`${c}/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:i.endpoint})}),await i.unsubscribe()),t(!1)}catch(e){console.error(e)}r(!1)}async function g(){r(!0);try{(await fetch(`${c}/sendNotification`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Test reminder",body:"This is a test push notification from your push-server."})})).ok?alert("Server accepted send request. Check your device for the push (if subscribed)."):alert("Server failed to send test push")}catch(e){console.error(e),alert("Failed to send test push — check server logs.")}r(!1)}return l?s.jsxs("div",{style:{marginTop:12},children:[s.jsx("div",{className:"small",children:"Background notifications (optional)"}),s.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[a?s.jsx("button",{className:"button",onClick:b,disabled:p,children:"Disable Background Notifications"}):s.jsx("button",{className:"button",onClick:h,disabled:p,children:"Enable Background Notifications"}),s.jsx("button",{className:"button",onClick:g,disabled:p||!a,children:"Send Test Push"})]}),s.jsxs("div",{className:"small",style:{marginTop:8},children:["Permission: ",u]}),s.jsxs("div",{className:"small",style:{marginTop:6},children:["Server: ",c]})]}):s.jsx("div",{className:"small",children:"Background notifications are not supported in this browser."})}export{N as default};
